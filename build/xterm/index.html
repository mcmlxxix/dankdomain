<!DOCTYPE html>
<html lang="en-US">
<head>
<title>Dank Domain: the return of Hack & Slash</title>
<style>
  body {
    background-color: midnightblue;
    color: antiquewhite;
  }
  #terminal {
    border: 0;
    top: 0; left: 0;
    width: 80%;
    height: 100%;
    position: fixed;
  }
  #Info {
    top: 0; right: 0;
    width: 20%;
    height: 100%;
    position: fixed;
  }
/*
  #Profile {
    top: 0; right: 0;
    width: 20%;
    height: 100%;
    position: fixed;
  }
  #Enemy {
    top: 50%; right: 0;
    width: 20%;
    height: 25%;
    position: fixed;
  }
  #Action {
    top: 50%; right: 0;
    width: 20%;
    height: 50%;
    position: fixed;
  }
*/
</style>
<link rel="stylesheet" href="xterm.css">
<script>
if (window.addEventListener) {
    window.addEventListener("message", receive, false);       
}
else {
    if (window.attachEvent) {
        window.attachEvent("onmessage", receive, false);
    }
}

function receive(event) {
  if (event.data) {
    console.log(event.data.func);
    switch(event.data.func) {
      case 'kb':
      case 'emit':
      if (!carrier) newSession();
        if (event.data.message) {
          socket.emit('data', termid, event.data.message);
          if (event.data.return)
            socket.emit('data', termid, '\x0A');
        }
        else {
          if (event.data.return)
            socket.emit('data', termid, '\x0D');
        }
        break;
/*
      case 'size':
        var stylesheet = document.styleSheets[0];
        for (var i in stylesheet.cssRules) {
          css = stylesheet.cssRules[i];
          if (css.selectorText === '#Info') {
            break;
          }
        }
        switch(event.data.message) {
          case 'full':
            Object.assign(css.style, { 'top':'0%', 'height':'100%', 'width':'20%' });
            break;
          case 'half':
            Object.assign(css.style, { 'top':'50%', 'height':'50%', 'width':'20%' });
            break;
          case 'small':
            Object.assign(css.style, { 'top':'75%', 'height':'25%', 'width':'20%' });
            break;
        }
        break;
    }
*/
    if (event.data.func === 'kb')
        term.focus();
    }
  }
}

function resize() {
  term.fit();
  console.log(`resize(${termid}, ${term.cols}, ${term.rows})`)

  var stylesheet = document.styleSheets[0];
  for (var i in stylesheet.cssRules) {
    css = stylesheet.cssRules[i];
    if (css.selectorText === '#terminal')
      l = css;
    if (css.selectorText === '#Info')
      r = css;
  }

  w = 20;
  do {
    w = (parseInt(w) + 2) + '%';
    v = (100 - parseInt(w)) + '%';
    Object.assign(l.style, { 'top':'0%', 'height':'100%', 'width':v });
    Object.assign(r.style, { 'top':'0%', 'height':'100%', 'width':w });
    term.fit();
  } while(term.cols > 90 && parseInt(w) < 40);
  console.log(`resize(${termid}, ${term.cols}, ${term.rows}) for ${l.selectorText}(${v}) & ${r.selectorText}(${w})`)
 }
</script>
</head>
<body onresize="resize();">
<div id="terminal"></div>
<iframe seamless id="Info" name="Info" src="./info.html"></iframe>
<!--iframe seamless id="Enemy" name="Enemy" src="./enemy.html"></iframe>
<iframe seamless id="Profile" name="Profile" src="./profile.html"></iframe>
<iframe seamless id="Action" name="Action" src="./action.html"></iframe-->
<h2>Dank Domain: the return of Hack &amp; Slash</h2>
<h3>&copy;2017 Robert Hurst</h3>
<h4>use REFRESH button to start over</h4>
<input type="button" value="REFRESH" onclick="window.location.reload();">
<script src="socket.io/socket.io.js"></script>
<script src="xterm/dist/xterm.js"></script>
<script src="xterm/dist/addons/fit/fit.js"></script>
<script src="main.js"></script>
</body>
</html>