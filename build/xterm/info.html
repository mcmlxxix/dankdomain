<!doctype html>
<html>
<head>
<title>Dank Domain</title>
<link href='https://fonts.googleapis.com/css?family=Carter+One' rel='stylesheet'>
<link rel="stylesheet" href="command.css">
<style>
  body {
    text-align: center;
    background: antiquewhite;  /*  older browsers  */
    background: -webkit-linear-gradient(left top, antiquewhite, gray);  /*  safari 5.1 to 6.0  */
    background: -o-linear-gradient(bottom right, antiquewhite, gray );  /*  opera 11.1 to 12.0  */
    background: -moz-linear-gradient(bottom right, antiquewhite, gray);  /*  firefox 3.6 to 15  */
    background: linear-gradient(to bottom right, white, skyblue);  /*  standard syntax (must be last)  */
    font-family: 'Carter One', cursive;
    font-size: 20px;
    color: midnightblue;
  }
  form {
    border: 3px solid #f1f1f1;
  }
  input[type=text], input[type=password] {
    width: 90%;
    padding: 12px 20px;
    margin: 8px 0;
    display: inline-block;
    border: 1px solid #ccc;
    box-sizing: border-box;
  }
  div {
    padding: 4px;
    margin: none;
    border: none;
  }
  img {
    max-width: 100%;
    max-height: 100%;
  }
</style>
<script>
art = null;
clear = `<input class="wide" type="button" value="Clear" onclick="send('\x15');">`;
enter = `<input class="wide" type="button" value="Enter" onclick="send('', true);">`;
logoff = `<input type="button" value="LOGOFF" onclick="send('\x1A');">`;
max = `<input class="wide" type="button" value=" MAX " onclick="send('MAX', true);">`
quit = `<input class="wide" type="button" value="Quit" onclick="send('Q');">`;
keypad = `<table align="center">
<tr><td><input class="numeric" type="button" value="7" onclick="send('7');"></td><td><input class="numeric" type="button" value="8" onclick="send('8');"></td><td><input class="numeric" type="button" value="9" onclick="send('9');"></td>
</tr>
<tr><td><input class="numeric" type="button" value="4" onclick="send('4');"></td><td><input class="numeric" type="button" value="5" onclick="send('5');"></td><td><input class="numeric" type="button" value="6" onclick="send('6');"></td>
</tr>
<tr><td><input class="numeric" type="button" value="1" onclick="send('1');"></td><td><input class="numeric" type="button" value="2" onclick="send('2');"></td><td><input class="numeric" type="button" value="3" onclick="send('3');"></td>
</tr>
<tr><td><input class="numeric" type="button" value=" 0 " onclick="send('0');"></td><td colspan=2>${enter}</td>
</tr>
<tr><td><input class="numeric" type="button" value=" ? " onclick="send('?', true);"></td><td colspan=2>${clear}</td>
</tr>
</table>`;
keyboard=`<input type="button" value="a" onclick="send('a');"> <input type="button" value="b" onclick="send('b');"> <input type="button" value="c" onclick="send('c');">
<input type="button" value="d" onclick="send('d');"> <input type="button" value="e" onclick="send('e');"> <input type="button" value="f" onclick="send('f');">
<input type="button" value="g" onclick="send('g');"> <input type="button" value="h" onclick="send('h');"> <input type="button" value="i" onclick="send('i');">
<input type="button" value="j" onclick="send('j');"> <input type="button" value="k" onclick="send('k');"> <input type="button" value="l" onclick="send('l');">
<input type="button" value="m" onclick="send('m');"> <input type="button" value="n" onclick="send('n');"> <input type="button" value="o" onclick="send('o');">
<input type="button" value="p" onclick="send('p');"> <input type="button" value="q" onclick="send('q');"> <input type="button" value="r" onclick="send('r');">
<input type="button" value="s" onclick="send('s');"> <input type="button" value="t" onclick="send('t');"> <input type="button" value="u" onclick="send('u');">
<input type="button" value="v" onclick="send('v');"> <input type="button" value="w" onclick="send('w');"> <input type="button" value="x" onclick="send('x');">
<input type="button" value="y" onclick="send('y');"> <input type="button" value="z" onclick="send('z');"><br>
<input type="button" value="@" onclick="send('@');"> <input type="button" value="." onclick="send('.');"> <input class="wide" type="button" value=" SPACE BAR " onclick="send(' ');"> <input type="button" value="-" onclick="send('-');"> <input type="button" value="+" onclick="send('+');"><br>
${keypad}
`;
money = `<table align="center">
<tr><td><input class="numeric" type="button" value="7" onclick="send('7');"></td><td><input class="numeric" type="button" value="8" onclick="send('8');"></td><td><input class="numeric" type="button" value="9" onclick="send('9');"></td><td><input class="platinum" type="button" value="P" onclick="send('p');"></td>
</tr>
<tr><td><input class="numeric" type="button" value="4" onclick="send('4');"></td><td><input class="numeric" type="button" value="5" onclick="send('5');"></td><td><input class="numeric" type="button" value="6" onclick="send('6');"></td><td><input class="gold" type="button" value="G" onclick="send('g');"></td>
</tr>
<tr><td><input class="numeric" type="button" value="1" onclick="send('1');"></td><td><input class="numeric" type="button" value="2" onclick="send('2');"></td><td><input class="numeric" type="button" value="3 " onclick="send('3');"></td><td><input class="silver" type="button" value="S" onclick="send('s');"></td>
</tr>
<tr><td colspan=2>${enter}</td><td><input class="numeric" type="button" value=" 0 " onclick="send('0');"></td><td><input class="copper" type="button" value="C" onclick="send('c');"></td>
</tr>
<tr><td colspan=2>${clear}</td><td colspan=2><input class="wide" type="button" value=" MAX " onclick="send('MAX', true);"></td>
</tr>
</table>`;

if (window.addEventListener) {
    window.addEventListener("message", receive, false);       
}
else {
    if (window.attachEvent) {
        window.attachEvent("onmessage", receive, false);
    }
}

function receive(event) {
  if (event.data) {
    if (event.data.func) {
      window[event.data.func]();
      return
    }

    if (event.data.mob1) {
      var html=`<table align="center">
        <tr><td><img src="images/${event.data.mob1}.png"></td><td><img src="images/${event.data.mob2}.png"></td></tr>`
      if (event.data.mob3)
        html += `<tr><td colspan=2><img src="images/${event.data.mob3}.png"></td></tr>`
      html += `</table>`
      nme(html)
      return
    }

    var html = '<p>';
    if (event.data.handle) {
      html += `${event.data.handle}`;
    }
    if (event.data.level) {
      html += ` a level ${event.data.level} `;
    }
    if (event.data.pc) {
      html += ` ${event.data.pc} `;
    }
    if (event.data.jpg) {
      html += `<br><img src="images/${event.data.jpg}.jpg" onload="nmeResize();">`;
    }
    if (event.data.png) {
      html += `<br><img src="images/${event.data.png}.png" onload="nmeResize();">`;
    }
    html += '</p>';
    nme(html);
  }
}

function nme(html) {
  document.getElementById("nme").innerHTML = html;
}

function cmd(html) {
  document.getElementById("command").innerHTML = html;
}

function Logon() {
  clearInterval(art);
  cmd(`<form onsubmit="return sendLogin();">
<input type="text" placeholder="Enter ID or Handle" name="id" autofocus required>
<input type="password" placeholder="Enter password" name="password" required>
<button class="wide" type="submit"> Login </button> <input class="wide" type="button" value="NEW" onclick="send('NEW', true);">
</form>`);
nme(`<img src="images/npc/city_guard_2.png" onload="nmeResize();">`);
}

function sendLogin() {
  setTimeout(function(){ send(document.forms[0].elements[0].value, true); }, 100);
  setTimeout(function(){ send(document.forms[0].elements[1].value, true); }, 1000);
  return false;
}

function Logoff() {
  art = setInterval(rotateImage, 45000);
  cmd(`<p><input class="tall" type="button" value=" CONNECT " onclick="send(' ');"></p>`);
}

function rotateImage() {
  var images = [
    'arexielite_by_peachyco.png',
    'dragonborn_dagger_sorcerer_by_peachyco.png',
    'dragonborn_hexblade_by_peachyco.png',
    'elf_cleric_by_peachyco.png',
    'elf_fighter_by_peachyco.png',
    'guild_findsman_by_peachyco.png',
    'human_battlemage_by_peachyco.png',
    'human_enchantress_mage_by_peachyco.png',
    'human_warpriest_by_peachyco.png',
    'human_wizard_by_peachyco.png',
    'kashaw_and_zahra_by_peachyco.png',
    'krauser_dragonborn_warlord_by_peachyco.png',
    'lucien2_human_wizard_by_peachyco.png',
    'lucien_human_wizard_by_peachyco.png',
    'orc_pirate_by_peachyco.png',
    'paladin_by_peachyco.png',
    'thrask_goliath_fighter_by_peachyco.png',
    'warforged_fighter_and_human_wizard_by_peachyco.png',
    'yuriel_genasi_warlord_by_peachyco.png'
 ];

  var n = Math.trunc(Math.random() * images.length);
  nme(`<img src="images/${images[n]}" onload="nmeResize();"/>`);
}

function send(keystrokes, cr = false, et = 'emit') {
  window.parent.postMessage({ 'func':et, 'message':keystrokes, 'return':cr }, '*');
}

/*
<!-- onkeypress="keypress(event);" -->
function keypress(event) {
  var x = event.which || event.keyCode;
  send(String.fromCharCode(x), false, 'kb');
}
*/

function actionResize(profile) {
  window.parent.postMessage({
    'func':'size', 'message':profile }, location.href);  
}

function clear() {
  cmd('');
}

function freetext() {
  nme('');
  cmd(`${keyboard}`);
}

function menu() {
  nme('');
  cmd(`
<input type="button" value="Arena" onclick="send('A');">
<input type="button" value="Dungeon" onclick="send('D');">
<input type="button" value="Casino" onclick="send('G');"><br>
<input type="button" value="Halls" onclick="send('L');">
<input type="button" value="Most Wanted" onclick="send('M');">
<input type="button" value="Naval" onclick="send('N');"><br>
<input type="button" value="Party" onclick="send('P');">
<input type="button" value="Rob" onclick="send('R');">
<input type="button" value="Square" onclick="send('S');"><br>
<input type="button" value="Tavern" onclick="send('T');">
<input type="button" value="Reroll" onclick="send('X');">
<input type="button" value="Status" onclick="send('Y');"><br>
<input type="button" value="System" onclick="send('Z');">
<p>${logoff}</p>
`);
}

function arena() {
  cmd(`
<input type="button" value="Cast" onclick="send('C');">
<input type="button" value="Poison" onclick="send('P');">
<input type="button" value="User" onclick="send('U');">
<input type="button" value="Monster" onclick="send('M');">
<input type="button" value="Joust" onclick="send('J');">
<input type="button" value="Status" onclick="send('Y');"><br>
<input class="tall" type="button" value="SQUARE" onclick="send('G');"> ${quit}
`);
}

function battle() {
  cmd(`
<input type="button" value="Attack" onclick="send('A');">
<input type="button" value="Cast" onclick="send('C');">
<input type="button" value="Retreat" onclick="send('R');">
<input type="button" value="Status" onclick="send('Y');">
`);
}

function riddle() {
  cmd(`
<p><input class="platinum" type="button" value=" Platinum " onclick="send('p');"></p>
<p><input class="gold"     type="button" value="   Gold   " onclick="send('g');"></p>
<p><input class="silver"   type="button" value="  Silver  " onclick="send('s');"></p>
<p><input class="copper"   type="button" value="  Copper  " onclick="send('c');"></p>
`);
}

function square() {
  nme('');
  cmd(`
<input type="button" value="Armoury" onclick="send('A');">
<input type="button" value="Weapons" onclick="send('W');">
<input type="button" value="Real Estate" onclick="send('R');">
<input type="button" value="Security" onclick="send('S');">
<input type="button" value="Mage" onclick="send('M');">
<input type="button" value="Apothecary" onclick="send('V');">
<input type="button" value="Bank" onclick="send('B');">
<input type="button" value="Hospital" onclick="send('H');">
<input type="button" value="Pick pockets" onclick="send('P');">
<input type="button" value="Jail" onclick="send('J');"><br>
<input class="tall" type="button" value="ARENA" onclick="send('G');"> ${quit}
`);
}

function list() {
  cmd(`${keypad}${max}`);
}

function bank() {
  cmd(`
${money}
<input type="button" value="Deposit" onclick="send('D');">
<input type="button" value="Withdraw" onclick="send('W');">
<input type="button" value="Loan" onclick="send('L');">
${quit}
`);
  nme(`<img src="images/bank.jpg" onload="nmeResize();">`);
}

function casino() {
  nme('');
  cmd(`<p><input class="wide" type="button" value=" ATM " onclick="send('I');"></p>
<p><input type="button" value="Black Jack" onclick="send('B');">
<input type="button" value="High Card" onclick="send('H');">
<input type="button" value="Craps" onclick="send('C');">
<input type="button" value="Dogs" onclick="send('D');">
<input type="button" value="Slots" onclick="send('S');">
<input type="button" value="Keno" onclick="send('K');">
<input type="button" value="Roulette" onclick="send('R');"></p>
${quit}`);
}

function dungeon() {
  nme('');
  cmd(`
<input class="tall" type="button" value=" North " onclick="send('N');"><br>
<input class="tall" type="button" value=" West " onclick="send('W');"> <input class="tall" type="button" value=" East " onclick="send('E');"><br>
<input class="tall" type="button" value=" South " onclick="send('S');"><br>
<p><input type="button" value="Cast" onclick="send('C');">
 <input type="button" value="Poison" onclick="send('P');">
 <input type="button" value="Status" onclick="send('Y');"></p>
`);
}

function naval() {
  nme('');
  cmd(`<p><input class="tall" type="button" value=" Battle " onclick="send('B');"></p>
<p><input type="button" value="Go Fishing" onclick="send('G');"> <input type="button" value="Hunt" onclick="send('H');">
<input type="button" value="List" onclick="send('L');"> <input type="button" value="Status" onclick="send('Y');"></p>
<input class="tall" type="button" value=" Quit " onclick="send('Q');">
`);
}

function party() {
  nme('');
  cmd(`<p><input class="tall" type="button" value=" Fight " onclick="send('F');"></p>
<p><input type="button" value="Join" onclick="send('J');"> <input type="button" value="List" onclick="send('L');">
<input type="button" value="Most Wanted" onclick="send('M');"> <input type="button" value="Resign" onclick="send('R');">
<input type="button" value="Start" onclick="send('S');"> <input type="button" value="Transfer" onclick="send('T');"></p>
<input class="tall" type="button" value=" Quit " onclick="send('Q');">
`);
}

function tavern() {
  nme('');
  cmd(`
<p><input class="tall" type="button" value=" Brawl " onclick="send('B');"></p>
<input type="button" value="Eavesdrop" onclick="send('E');"> <input type="button" value="Jump" onclick="send('J');"><br>
<input type="button" value="Guzzle" onclick="send('G');"> <input type="button" value="Swear" onclick="send('S');"><br>
<input type="button" value="List" onclick="send('L');"> <input type="button" value="Post" onclick="send('P');"><br>
<p><input type="button" value="Today" onclick="send('T');"> <input type="button" value="Yesterday" onclick="send('Y');"></p>
<input class="tall" type="button" value=" Quit " onclick="send('Q');">
`);
}

function yn() {
  cmd(`
<p><input class="tall" type="button" value=" Yes " onclick="send('Y');">
<input class="tall" type="button" value=" No " onclick="send('N');"></p>
${enter} ${quit}
`);
}

function nmeResize() {
  pic = document.getElementById('nme').getElementsByTagName('img')[0];
  ih = pic.height;
  iw = pic.width;
  h = Math.trunc(window.innerHeight * 0.96
    - document.getElementById('command').clientHeight
    - (document.getElementById('nme').clientHeight - ih));

  //  too tall?
  if (h < pic.height) {
    w = Math.trunc(iw * h / pic.height);
    pic.height = h;
    pic.width = w;
  }
}
</script>
</head>
<body>
<div id="command">Command Buttons</div>
<div class="nme" id="nme">Profile Sheet</div>
</body>
</html>